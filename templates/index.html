<!DOCTYPE html>
<html>
<head>
    <title>Learn with Leo the Puppy! ğŸ•ğŸ“š</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>Learn with Leo! ğŸ•âœ¨</h1>

    <div class="stats-container">
        <div class="stats">
            <div class="stat">
                <span class="stat-icon">â¤ï¸</span>
                <span class="happiness-value">50%</span>
            </div>
            <div class="stat">
                <span class="stat-icon">â­</span>
                <span class="energy-value">100%</span>
            </div>
        </div>

        <div class="happiness-meter">
            <div class="happiness-fill"></div>
        </div>
    </div>

    <!-- Puppy Container - The main character -->
    <div class="puppy-container">
        <img src="Gemini_Generated_Image_mijuvdmijuvdmiju.jpeg" alt="Leo the Puppy" class="puppy-image">
        <div class="video-container">
            <video id="petVideo" src="Standard_Mode_dog_licking_his_paw_.mp4" style="display: none"></video>
            <video id="playVideo" src="Standard_Mode_dog_playing___jumping.mp4" style="display: none"></video>
            <video id="treatVideo" src="Standard_Mode_dog_sitting___licking_his_paw_.mp4" style="display: none"></video>
        </div>
    </div>

    <!-- Reward options when answering correctly -->
    <div class="interaction-items">
        <div class="interaction-item" data-type="pet">
            <span>ğŸ¤š</span> Pet Leo
        </div>
        <div class="interaction-item" data-type="play">
            <span>ğŸ¾</span> Play Ball
        </div>
        <div class="interaction-item" data-type="treat">
            <span>ğŸ¦´</span> Give Treat
        </div>
    </div>

    <!-- Main learning container -->
    <div class="reading-container">
        <h2>Spell with Leo! ğŸ“</h2>
        
        <!-- Simple stats display -->
        <div class="progress-stats">
            <div class="stat-item">
                <span class="stat-icon">â­</span>
                <span class="stat-label">Score:</span>
                <span class="success-rate">0%</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ”¥</span>
                <span class="stat-label">Streak:</span>
                <span class="consecutive-correct">0</span>
            </div>
        </div>

        <!-- The word to spell - large display -->
        <div class="word-display">Ready to start!</div>
        <div class="review-word-indicator" style="display: none;">
            <span class="review-star">â­</span>
            <span class="review-text">Practice Word</span>
        </div>
        
        <!-- Speech controls - simplified -->
        <div class="speech-container">
            <div class="speech-status">Listen to the spelling and say the word!</div>
            <div class="button-group">
                <button class="speak-word-btn" title="Hear spelling again">ğŸ”Š</button>
                <button class="mic-button" title="Click to speak">ğŸ¤</button>
            </div>
        </div>
        
        <!-- Text input as backup -->
        <input type="text" class="reading-input" placeholder="Or type the word here..." autocomplete="off">
        
        <!-- Control buttons -->
        <div class="control-buttons">
            <button class="next-word-btn">Next Word</button>
            <button class="settings-toggle-btn">âš™ï¸ Settings</button>
        </div>
        
        <!-- Settings (hidden by default, shown with a settings button) -->
        <div class="settings-controls">
            <h3>Difficulty</h3>
            <div class="difficulty-selector">
                <button class="difficulty-btn easy active" data-difficulty="easy">Easy</button>
                <button class="difficulty-btn medium" data-difficulty="medium">Medium</button>
                <button class="difficulty-btn hard" data-difficulty="hard">Hard</button>
            </div>
            
            <h3>Word Categories</h3>
            <div class="category-selector">
                <button class="category-btn active" data-category="animals">Animals</button>
                <button class="category-btn" data-category="colors">Colors</button>
                <button class="category-btn" data-category="numbers">Numbers</button>
                <button class="category-btn" data-category="objects">Objects</button>
                <button class="category-btn" data-category="food">Food</button>
                <button class="category-btn" data-category="nature">Nature</button>
            </div>
        </div>
        
        <!-- Success message -->
        <div class="reward-container">
            <p>Great job! Choose your reward:</p>
        </div>
    </div>

    <script src="/static/js/learning_path.js"></script>
    <script src="/static/js/video-generator.js"></script>
    <script src="/static/js/progress_tracker.js"></script>
    <script src="/static/js/word_bank.js"></script>
    
    <script>
    // DOM Element declarations
    const puppy = document.querySelector('.puppy-image');
    const happinessFill = document.querySelector('.happiness-fill');
    const happinessValue = document.querySelector('.happiness-value');
    const energyValue = document.querySelector('.energy-value');
    const interactionItems = document.querySelector('.interaction-items');
    const wordDisplay = document.querySelector('.word-display');
    const readingInput = document.querySelector('.reading-input');
    const nextWordBtn = document.querySelector('.next-word-btn');
    const rewardContainer = document.querySelector('.reward-container');
    const micButton = document.querySelector('.mic-button');
    const speechStatus = document.querySelector('.speech-status');
    const speakWordBtn = document.querySelector('.speak-word-btn');
    const difficultyBtns = document.querySelectorAll('.difficulty-btn');
    const categoryBtns = document.querySelectorAll('.category-btn');

    // State variables
    let happiness = 50;
    let energy = 100;
    let currentWord = '';
    let recognition = null;
    let speechTimeout = null;

    // Hide the settings by default and add a toggle button
    document.querySelector('.settings-controls').style.display = 'none';
    
    // Browser compatibility check
    if (!('webkitSpeechRecognition' in window)) {
        console.warn('Speech recognition not supported in this browser');
        speechStatus.textContent = 'Speech recognition not available. Just type the word!';
        micButton.disabled = true;
        micButton.style.opacity = '0.5';
    } else {
        // Initialize Speech Recognition with simplified interface for children
        if (!recognition) {
            try {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';

                console.log('Speech recognition initialized successfully');

                recognition.onstart = () => {
                    console.log('Speech recognition started');
                    micButton.classList.add('listening');
                    speechStatus.textContent = 'I\'m listening! Say the word...';
                    micButton.style.transform = 'scale(1.1)';
                    
                    // Create some visual effects when listening
                    createParticles(
                        micButton.getBoundingClientRect().left + micButton.getBoundingClientRect().width/2,
                        micButton.getBoundingClientRect().top + micButton.getBoundingClientRect().height/2,
                        'mic'
                    );

                    // Add timeout after 5 seconds of no speech
                    speechTimeout = setTimeout(() => {
                        if (micButton.classList.contains('listening')) {
                            recognition.stop();
                            speechStatus.textContent = 'Try again! Press the mic button ğŸ¤';
                        }
                    }, 5000);
                };

                recognition.onend = () => {
                    console.log('Speech recognition ended');
                    micButton.classList.remove('listening');
                    speechStatus.textContent = 'Press the mic button ğŸ¤ to say the word!';
                    micButton.style.transform = 'scale(1)';
                    if (speechTimeout) {
                        clearTimeout(speechTimeout);
                        speechTimeout = null;
                    }
                };

                recognition.onresult = (event) => {
                    if (speechTimeout) {
                        clearTimeout(speechTimeout);
                        speechTimeout = null;
                    }
                    const transcript = event.results[0][0].transcript.toLowerCase().trim();
                    const confidence = event.results[0][0].confidence;

                    console.log('Speech recognized:', transcript, 'Confidence:', confidence);

                    // Update input field immediately
                    readingInput.value = transcript;

                    // Clean up both the transcript and current word for comparison
                    // For young children, be EXTREMELY lenient with matching
                    const cleanTranscript = transcript.replace(/[^a-zA-Z]/g, '').toLowerCase();
                    const cleanCurrentWord = currentWord.replace(/[^a-zA-Z]/g, '').toLowerCase();
                    
                    console.log('Comparing:', cleanTranscript, 'with target word:', cleanCurrentWord);
                    
                    // Use a VERY forgiving matching algorithm designed specifically for children
                    // 1. Exact match
                    // 2. If the transcript contains the word (e.g., "a duck" for "duck")
                    // 3. If the transcript is contained in the word (e.g., "do" for "dog")
                    // 4. If the first letter matches and was spoken clearly (for very short words)
                    // 5. Using Levenshtein distance to allow for child pronunciation errors
                    
                    const exactMatch = cleanTranscript === cleanCurrentWord;
                    const containsMatch = cleanTranscript.includes(cleanCurrentWord);
                    const reverseContainsMatch = cleanCurrentWord.includes(cleanTranscript) && cleanTranscript.length > 1;
                    const firstLetterMatch = cleanCurrentWord.length <= 3 && cleanTranscript.charAt(0) === cleanCurrentWord.charAt(0);
                    
                    // Calculate letter matching percentage for more forgiving comparison
                    let matchCount = 0;
                    const minLength = Math.min(cleanTranscript.length, cleanCurrentWord.length);
                    for (let i = 0; i < minLength; i++) {
                        if (cleanTranscript.charAt(i) === cleanCurrentWord.charAt(i)) {
                            matchCount++;
                        }
                    }
                    const percentMatch = minLength > 0 ? matchCount / minLength : 0;
                    const goodEnoughMatch = percentMatch >= 0.5 && minLength > 1;
                    
                    console.log('Match details:', {
                        exactMatch, 
                        containsMatch, 
                        reverseContainsMatch, 
                        firstLetterMatch, 
                        percentMatch, 
                        goodEnoughMatch
                    });
                    
                    const isMatch = exactMatch || containsMatch || reverseContainsMatch || firstLetterMatch || goodEnoughMatch;

                    if (isMatch) {
                        wordBank.recordAttempt(currentWord, true);
                        updateProgressDisplay();
                        
                        // Show large, exciting success feedback with animation
                        wordDisplay.innerHTML = 'ğŸŒŸ <span class="success-text">Correct!</span> ğŸŒŸ';
                        wordDisplay.style.color = '#FFDE00';
                        
                        // Immediately display reward options
                        rewardContainer.style.display = 'block';
                        interactionItems.style.display = 'flex';
                        
                        // Congratulate the child with enthusiastic voice
                        speakWord("Fantastic! You did it! Choose your reward!");

                        // Create large celebration effects around the puppy
                        createParticles(
                            puppy.getBoundingClientRect().left + puppy.getBoundingClientRect().width/2,
                            puppy.getBoundingClientRect().top + puppy.getBoundingClientRect().height/2,
                            'correct'
                        );
                        
                        // Animate the puppy with excitement
                        puppy.classList.add('happy-bounce');
                        setTimeout(() => {
                            puppy.classList.remove('happy-bounce');
                        }, 1500);
                        
                        // Simple encouraging feedback for children
                        speechStatus.textContent = `Amazing job! You're so smart! ğŸ‰`;
                        
                        // Pulse effect on reward options to draw attention
                        interactionItems.querySelectorAll('.interaction-item').forEach(item => {
                            item.classList.add('reward-attention');
                            setTimeout(() => {
                                item.classList.remove('reward-attention');
                            }, 2000);
                        });
                    } else {
                        wordBank.recordAttempt(currentWord, false);
                        updateProgressDisplay();
                        
                        // For children, don't emphasize "incorrect" too much
                        // We want them to feel encouraged to try again
                        
                        // Calculate how close they were to encourage improvement
                        let encouragementMessage = '';
                        if (percentMatch >= 0.3) {
                            // They were pretty close
                            encouragementMessage = `You're so close! The word is ${currentWord}.`;
                            wordDisplay.textContent = 'ğŸ’ª Almost there!';
                        } else {
                            // They need more guidance
                            encouragementMessage = `Let's try again! The word is ${currentWord}.`;
                            wordDisplay.textContent = 'ğŸ”Š Listen one more time!';
                        }
                        
                        wordDisplay.style.color = '#ffffff';
                        
                        // Hide reward options
                        rewardContainer.style.display = 'none';
                        interactionItems.style.display = 'none';
                        
                        // Provide VERY encouraging feedback with the correct word
                        speakWord(encouragementMessage);
                        
                        // Gentle visual feedback - puppy is supportive
                        puppy.classList.add('encouraging-wiggle');
                        setTimeout(() => {
                            puppy.classList.remove('encouraging-wiggle');
                            // Spell out the word again automatically after a delay
                            setTimeout(() => {
                                spellOutWord();
                                
                                // Automatically activate the mic again after spelling out
                                setTimeout(() => {
                                    if (recognition) {
                                        recognition.start();
                                    }
                                }, 4000); // Wait after spelling completes
                                
                            }, 1000);
                        }, 1500);

                        // Simple supportive feedback for children
                        speechStatus.textContent = `Good try! You can do it! ğŸ’ª`;
                    }
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    
                    // Simplified error messages for children
                    speechStatus.textContent = "I couldn't hear you. Try again!";
                    micButton.classList.remove('listening');

                    if (speechTimeout) {
                        clearTimeout(speechTimeout);
                        speechTimeout = null;
                    }
                };
            } catch (error) {
                console.error('Error initializing speech recognition:', error);
                speechStatus.textContent = "Something went wrong. Try typing instead!";
                micButton.disabled = true;
            }
        }
    }

    // Initialize WordBank
    const wordBank = new WordBank();

    // Function Definitions
    function updateStats() {
        happiness = Math.min(100, Math.max(0, happiness));
        energy = Math.min(100, Math.max(0, energy));
        
        happinessFill.style.width = `${happiness}%`;
        happinessValue.textContent = `${Math.round(happiness)}%`;
        energyValue.textContent = `${Math.round(energy)}%`;
    }

    function createParticles(x, y, type) {
        const particles = {
            'pet': ['ğŸ’–', 'âœ¨', 'ğŸ’«'],
            'play': ['ğŸ¾', 'âš¡', 'ğŸŒŸ'],
            'treat': ['ğŸ¦´', 'â¤ï¸', 'ğŸ–'],
            'mic': ['ğŸ¤', 'ğŸ”Š', 'ğŸ‘‚', 'ğŸ—£ï¸'],
            'correct': ['ğŸ‰', 'â­', 'ğŸŒŸ', 'ğŸ‘', 'ğŸŠ'],
            'reviewStar': ['â­', 'âœ¨', 'ğŸ’«', 'ğŸŒ ']
        };
        
        const emojis = particles[type] || particles.pet;
        const count = type === 'correct' ? 12 : 6;
        
        for (let i = 0; i < count; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            
            // Different behavior for different particle types
            if (type === 'mic') {
                // Mic particles move in a circular pattern
                const angle = Math.random() * Math.PI * 2;
                const distance = 30 + Math.random() * 20;
                particle.style.left = `${x + Math.cos(angle) * distance}px`;
                particle.style.top = `${y + Math.sin(angle) * distance}px`;
                particle.style.fontSize = '1.2rem';
            } else if (type === 'correct') {
                // Celebration particles cover more area
                particle.style.left = `${x + (Math.random() - 0.5) * 200}px`;
                particle.style.top = `${y + (Math.random() - 0.5) * 200}px`;
                particle.style.fontSize = '1.8rem';
            } else {
                // Standard particles
                particle.style.left = `${x + (Math.random() - 0.5) * 100}px`;
                particle.style.top = `${y + (Math.random() - 0.5) * 100}px`;
                particle.style.fontSize = '1.5rem';
            }
            
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 1500);
        }
    }

    function interactWithLeo(e) {
        const rect = puppy.getBoundingClientRect();
        const type = e.currentTarget.dataset.type;
        
        // Create fun particles around the puppy
        createParticles(rect.left + rect.width/2, rect.top + rect.height/2, type);
        
        // Hide the puppy image to show the video
        puppy.style.opacity = '0';
        
        // Make sure all videos are stopped and hidden
        document.querySelectorAll('.video-container video').forEach(v => {
            v.style.opacity = '0';
            v.style.display = 'none';
            v.pause();
            v.currentTime = 0;
        });
        
        // Select the right video and update stats based on interaction type
        let video;
        switch(type) {
            case 'pet':
                video = document.getElementById('petVideo');
                happiness += 5;
                energy += 2;
                // Give positive feedback
                speakWord("Leo loves pets! Good job!");
                break;
            case 'play':
                if (energy >= 10) {
                    video = document.getElementById('playVideo');
                    happiness += 15;
                    energy -= 10;
                    // Give positive feedback
                    speakWord("Yay! Leo loves playing fetch!");
                } else {
                    // Not enough energy - give feedback
                    speakWord("Leo is too tired to play right now.");
                }
                break;
            case 'treat':
                video = document.getElementById('treatVideo');
                happiness += 10;
                energy += 15;
                // Give positive feedback
                speakWord("Mmm! Leo loves treats!");
                break;
        }
        
        // Show and play the selected video with animation
        if (video) {
            // Apply a border to the video for better visibility
            video.style.display = 'block';
            
            // Fade in the video
            requestAnimationFrame(() => {
                video.style.opacity = '1';
                video.play().catch(() => {
                    // Fallback if video can't play
                    video.style.opacity = '0';
                    video.style.display = 'none';
                    puppy.style.opacity = '1';
                });
            });
            
            // When video ends, fade it out and show the puppy again
            video.onended = function() {
                video.style.opacity = '0';
                setTimeout(() => {
                    video.style.display = 'none';
                    requestAnimationFrame(() => {
                        puppy.style.opacity = '1';
                    });
                }, 300);
                
                // Give feedback when video ends
                speakWord("Great job! Let's try another word!");
            };
        } else {
            // If no video, just show the puppy
            requestAnimationFrame(() => {
                puppy.style.opacity = '1';
            });
        }
        
        // Update UI and move to next word
        updateStats();
        interactionItems.style.display = 'none';
        readingInput.value = '';
        
        // Small delay before next word to allow the child to enjoy the reward
        setTimeout(() => {
            updateWord();
        }, 1500);
    }

    function getRandomWord() {
        return wordBank.getRandomWord();
    }

    function spellOutWord() {
        let currentIndex = 0;
        const letters = currentWord.split('');
        
        if (!wordDisplay.textContent.includes(letters.join(' '))) {
            wordDisplay.textContent = ''; 
        }
        
        const spellInterval = setInterval(() => {
            if (currentIndex < letters.length) {
                if (!wordDisplay.textContent.includes(letters.join(' '))) {
                    wordDisplay.textContent += letters[currentIndex] + ' ';
                }
                speakWord(letters[currentIndex]); 
                currentIndex++;
            } else {
                clearInterval(spellInterval);
                readingInput.focus();
            }
        }, 1000); 
    }

    function updateProgressDisplay() {
        const stats = wordBank.getProgressStats();
        document.querySelector('.success-rate').textContent = `${Math.round(stats.successRate)}%`;
        document.querySelector('.consecutive-correct').textContent = stats.consecutiveCorrect;
        
        // Only update review-count if it exists
        const reviewCount = document.querySelector('.review-count');
        if (reviewCount) {
            reviewCount.textContent = stats.reviewQueueLength;
        }
    }

    function updateWord() {
        currentWord = getRandomWord();
        readingInput.value = '';
        rewardContainer.style.display = 'none';
        interactionItems.style.display = 'none';
        
        // Hide review word indicator by default
        document.querySelector('.review-word-indicator').style.display = 'none';
        
        // Check if this is a review word and show indicator if it is
        if (wordBank.isReviewWord()) {
            setTimeout(() => {
                document.querySelector('.review-word-indicator').style.display = 'flex';
                
                // Create sparkle effects around the review star
                const indicator = document.querySelector('.review-word-indicator');
                const rect = indicator.getBoundingClientRect();
                createParticles(
                    rect.left + rect.width/2,
                    rect.top + rect.height/2,
                    'reviewStar'
                );
                
                // Special message for review words to encourage practice
                speakWord("This is a special practice word! Let's try it again!");
            }, 500);
        }
        
        wordDisplay.textContent = 'Get ready...';
        setTimeout(() => {
            speakWord("Here's your word:");
            setTimeout(() => {
                spellOutWord();
                
                // Automatically activate microphone after spelling out the word
                // This makes it seamless for children - they don't have to click the mic
                setTimeout(() => {
                    if (recognition) {
                        // Visual cue that we're getting ready to listen
                        micButton.classList.add('auto-listening');
                        micButton.style.transform = 'scale(1.1)';
                        
                        // Create visual effects to draw attention to the mic
                        createParticles(
                            micButton.getBoundingClientRect().left + micButton.getBoundingClientRect().width/2,
                            micButton.getBoundingClientRect().top + micButton.getBoundingClientRect().height/2,
                            'mic'
                        );
                        
                        // Then start listening
                        setTimeout(() => {
                            speechStatus.textContent = "I'm listening! Say the word...";
                            recognition.start();
                        }, 1000);
                    }
                }, 3000); // Wait 3 seconds after spelling out the word
            }, 1000);
        }, 1000);
    }

    function checkWord() {
        const isCorrect = readingInput.value.toLowerCase().trim() === currentWord.toLowerCase();
        const progression = wordBank.recordAttempt(currentWord, isCorrect);
        
        if (isCorrect) {
            const stats = wordBank.getProgressStats();
            let message = 'ğŸŒŸ Correct! ğŸŒŸ';
            
            if (progression) {
                if (progression.type === 'advance') {
                    message = `ğŸ‰ Amazing! You've advanced to ${progression.newLevel} level! ğŸ‰`;
                    difficultyBtns.forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.difficulty === progression.newLevel) {
                            btn.classList.add('active');
                        }
                    });
                }
            }
            
            wordDisplay.textContent = message;
            rewardContainer.style.display = 'block';
            interactionItems.style.display = 'flex';
            speakWord("Great job! Choose your reward!");
            
            createParticles(
                puppy.getBoundingClientRect().left + puppy.getBoundingClientRect().width/2,
                puppy.getBoundingClientRect().top + puppy.getBoundingClientRect().height/2,
                'pet'
            );
            
        } else if (readingInput.value.length >= currentWord.length) {
            wordDisplay.textContent = 'âŒ Try again!';
            rewardContainer.style.display = 'none';
            interactionItems.style.display = 'none';
            speakWord("Try again!");
            
            if (progression && progression.type === 'regress') {
                wordDisplay.textContent = `Let's try some easier words! Moving to ${progression.newLevel} level.`;
                difficultyBtns.forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.difficulty === progression.newLevel) {
                        btn.classList.add('active');
                    }
                });
            }
        }
        
        updateProgressDisplay();
    }

    // Event Listeners
    document.querySelectorAll('.interaction-item').forEach(item => {
        item.addEventListener('click', interactWithLeo);
    });

    difficultyBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            difficultyBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            wordBank.setDifficulty(btn.dataset.difficulty);
            updateWord();
        });
    });

    categoryBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            categoryBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            wordBank.setCategory(btn.dataset.category);
            updateWord();
        });
    });

    readingInput.addEventListener('input', () => {
        checkWord();
    });

    nextWordBtn.addEventListener('click', updateWord);

    // Event Listeners for Speech Features
    micButton.addEventListener('click', () => {
        console.log('Mic button clicked');
        if (recognition) {
            // Check if recognition is already active
            if (micButton.classList.contains('listening') || micButton.classList.contains('auto-listening')) {
                console.log('Recognition already active, stopping first');
                recognition.stop();
                // Wait a moment before restarting
                setTimeout(() => {
                    recognition.start();
                }, 300);
            } else {
                recognition.start();
            }
        } else {
            alert('Speech recognition is not supported in your browser.');
        }
    });

    speakWordBtn.addEventListener('click', () => {
        speechSynthesis.cancel();
        spellOutWord();
    });
    
    // Settings toggle button
    const settingsToggleBtn = document.querySelector('.settings-toggle-btn');
    const settingsControls = document.querySelector('.settings-controls');
    
    settingsToggleBtn.addEventListener('click', () => {
        if (settingsControls.style.display === 'none' || !settingsControls.style.display) {
            settingsControls.style.display = 'block';
            settingsToggleBtn.textContent = 'âœ–ï¸ Close Settings';
        } else {
            settingsControls.style.display = 'none';
            settingsToggleBtn.textContent = 'âš™ï¸ Settings';
        }
    });

    // Speech Synthesis Setup
    const speechSynthesis = window.speechSynthesis;

    function speakWord(word) {
        if (speechSynthesis) {
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.rate = 0.8;
            utterance.pitch = 1;
            speechSynthesis.speak(utterance);
        }
    }

    // Initialize first word with speech
    updateWord();
    updateProgressDisplay();
    </script>
</body>
</html>