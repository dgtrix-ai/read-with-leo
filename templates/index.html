<!DOCTYPE html>
<html>
<head>
    <title>Read with Leo the Puppy! üêïüìö</title>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

    /* Keep existing styles */
    body {
        margin: 0;
        padding: 5px;
        min-height: 100vh;
        background: linear-gradient(135deg, #1a1d24 0%, #2c3037 100%);
        font-family: 'Poppins', sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #ffffff;
        gap: 5px;
        overflow-x: hidden;
    }

    /* Update puppy-container */
    .puppy-container {
        position: relative;
        width: 300px;
        height: 300px;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        perspective: 1000px;
        min-height: 300px;
        max-height: 300px;
        z-index: 2;
    }

    /* Update video-container */
    .video-container {
        position: absolute;
        width: 250px;
        height: auto;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1;
    }

    /* Update video element */
    .video-container video {
        width: 250px;
        height: auto;
        max-width: 100%;
        border-radius: 15px;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        position: absolute;
    }

    /* Keep other existing styles */
    .stats-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        margin: 10px 0;
    }

    .stats {
        display: flex;
        gap: 10px;
    }

    .stat {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 1.2rem;
    }

    .stat-icon {
        font-size: 1.5rem;
    }

    .happiness-meter {
        width: 100%;
        height: 10px;
        background-color: #333;
        border-radius: 5px;
        position: relative;
        overflow: hidden;
    }

    .happiness-fill {
        height: 100%;
        background-color: #ffd700;
        position: absolute;
        top: 0;
        left: 0;
        width: 50%;
        transition: width 0.3s ease-in-out;
    }

    .puppy-image {
        width: 250px;
        height: auto;
        opacity: 1;
        transition: opacity 0.3s ease-in-out;
    }

    .interaction-items {
        display: flex;
        gap: 10px;
        margin: 10px 0;
    }

    .interaction-item {
        background-color: #444;
        padding: 10px 15px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: background-color 0.3s ease-in-out;
    }

    .interaction-item:hover {
        background-color: #555;
    }

    .reading-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
        width: 100%;
        margin: 20px 0;
    }

    .word-display {
        font-size: 2rem;
        text-align: center;
    }

    .speech-container {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .button-group {
        display: flex;
        gap: 5px;
    }

    .mic-button,
    .speak-word-btn {
        background-color: #444;
        padding: 8px 12px;
        border-radius: 5px;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        transition: background-color 0.3s ease-in-out;
    }

    .mic-button.listening {
        background-color: #ffd700;
    }

    .mic-button:hover,
    .speak-word-btn:hover {
        background-color: #555;
    }

    .speech-status {
        font-size: 1rem;
    }

    .reading-input {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 5px;
        background-color: #333;
        color: #fff;
        font-size: 1.2rem;
    }

    .next-word-btn {
        background-color: #444;
        padding: 10px 15px;
        border-radius: 5px;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        transition: background-color 0.3s ease-in-out;
    }

    .next-word-btn:hover {
        background-color: #555;
    }

    .reward-container {
        display: none;
        align-items: center;
    }

    .particle {
        position: absolute;
        font-size: 1.5rem;
        opacity: 1;
        transition: opacity 0.3s ease-in-out;
    }
    </style>
</head>
<body>
    <h1>Play with Leo! üêï‚ú®</h1>

    <div class="stats-container">
        <div class="stats">
            <div class="stat">
                <span class="stat-icon">‚ù§Ô∏è</span>
                <span class="happiness-value">50%</span>
            </div>
            <div class="stat">
                <span class="stat-icon">‚≠ê</span>
                <span class="energy-value">100%</span>
            </div>
        </div>

        <div class="happiness-meter">
            <div class="happiness-fill"></div>
        </div>
    </div>

    <div class="puppy-container">
        <img src="/Gemini_Generated_Image_mijuvdmijuvdmiju.jpeg" alt="Adorable toy poodle puppy with golden-brown fur and expressive eyes" class="puppy-image">
        <div class="video-container">
            <video id="petVideo" style="display: none">
                <source src="/Standard_Mode_dog_licking_his_paw_.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <video id="playVideo" style="display: none">
                <source src="/Standard_Mode_dog_playing___jumping.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <video id="treatVideo" style="display: none">
                <source src="/Standard_Mode_dog_sitting___licking_his_paw_.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
    </div>

    <div class="interaction-items">
        <div class="interaction-item" data-type="pet">
            <span>ü§ö</span> Pet Leo
        </div>
        <div class="interaction-item" data-type="play">
            <span>üéæ</span> Play Ball
        </div>
        <div class="interaction-item" data-type="treat">
            <span>ü¶¥</span> Give Treat
        </div>
    </div>

    <div class="reading-container">
        <h2 style="color: #ffd700; margin: 5px 0;">Spell with Leo! üìù</h2>
        <div class="word-display">Ready to start!</div>
        <div class="speech-container">
            <div class="button-group">
                <button class="mic-button" title="Click to speak">üé§</button>
                <button class="speak-word-btn" title="Hear spelling again">üîä</button>
            </div>
            <div class="speech-status">Listen to the spelling and guess the word</div>
        </div>
        <input type="text" class="reading-input" placeholder="Type the word after hearing it spelled..." autocomplete="off">
        <button class="next-word-btn">Next Word</button>
        <div class="reward-container">
            <p style="color: #ffd700; margin: 10px 0;">Great job! Choose your reward:</p>
        </div>
    </div>

    <!-- Add video generator script -->
    <script src="/static/js/video-generator.js"></script>
    
    <script>
    // Add error event listeners to video elements
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.video-container video').forEach(video => {
            video.addEventListener('error', (e) => {
                console.log('Video error:', e);
                video.style.opacity = '0';
                video.style.display = 'none';
                puppy.style.opacity = '1';
            });
        });
    });

    let happiness = 50;
    let energy = 100;
    const puppy = document.querySelector('.puppy-image');
    const happinessFill = document.querySelector('.happiness-fill');
    const happinessValue = document.querySelector('.happiness-value');
    const energyValue = document.querySelector('.energy-value');
    const interactionItems = document.querySelector('.interaction-items');

    document.querySelectorAll('.interaction-item').forEach(item => {
        item.addEventListener('click', interactWithLeo);
    });

    function updateStats() {
        happiness = Math.min(100, Math.max(0, happiness));
        energy = Math.min(100, Math.max(0, energy));
        
        happinessFill.style.width = `${happiness}%`;
        happinessValue.textContent = `${Math.round(happiness)}%`;
        energyValue.textContent = `${Math.round(energy)}%`;
    }

    function createParticles(x, y, type) {
        const particles = {
            'pet': ['üíñ', '‚ú®', 'üí´'],
            'play': ['üéæ', '‚ö°', 'üåü'],
            'treat': ['ü¶¥', '‚ù§Ô∏è', 'üçñ']
        };
        
        const emojis = particles[type] || particles.pet;
        
        for (let i = 0; i < 6; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            particle.style.left = `${x + (Math.random() - 0.5) * 100}px`;
            particle.style.top = `${y + (Math.random() - 0.5) * 100}px`;
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 1500);
        }
    }

    function interactWithLeo(e) {
        const rect = puppy.getBoundingClientRect();
        const type = e.currentTarget.dataset.type;
        
        createParticles(rect.left + rect.width/2, rect.top + rect.height/2, type);
        
        puppy.style.opacity = '0';
        
        document.querySelectorAll('.video-container video').forEach(v => {
            v.style.opacity = '0';
            v.style.display = 'none';
            v.pause();
            v.currentTime = 0;
        });
        
        let video;
        switch(type) {
            case 'pet':
                video = document.getElementById('petVideo');
                happiness += 5;
                energy += 2;
                break;
            case 'play':
                if (energy >= 10) {
                    video = document.getElementById('playVideo');
                    happiness += 15;
                    energy -= 10;
                }
                break;
            case 'treat':
                video = document.getElementById('treatVideo');
                happiness += 10;
                energy += 15;
                break;
        }
        
        if (video) {
            video.style.display = 'block';
            requestAnimationFrame(() => {
                video.style.opacity = '1';
                video.play()
                    .then(() => {
                        // Video started playing successfully
                    })
                    .catch(error => {
                        console.log('Video playback failed:', error);
                        video.style.opacity = '0';
                        video.style.display = 'none';
                        puppy.style.opacity = '1';
                        // Trigger the canvas animation fallback
                        video.dispatchEvent(new Event('error'));
                    });
            });
            
            video.onended = function() {
                video.style.opacity = '0';
                setTimeout(() => {
                    video.style.display = 'none';
                    requestAnimationFrame(() => {
                        puppy.style.opacity = '1';
                    });
                }, 300);
            };
        } else {
            requestAnimationFrame(() => {
                puppy.style.opacity = '1';
            });
        }
        
        updateStats();
        interactionItems.style.display = 'none';
        readingInput.value = '';
        updateWord();
    }

    const words = ['puppy', 'play', 'happy', 'friend', 'love', 'bark', 'fetch', 'treat', 'walk', 'good'];
    let currentWord = '';
    const wordDisplay = document.querySelector('.word-display');
    const readingInput = document.querySelector('.reading-input');
    const nextWordBtn = document.querySelector('.next-word-btn');
    const rewardContainer = document.querySelector('.reward-container');

    function getRandomWord() {
        return words[Math.floor(Math.random() * words.length)];
    }

    function spellOutWord() {
        let currentIndex = 0;
        const letters = currentWord.split('');
        
        if (!wordDisplay.textContent.includes(letters.join(' '))) {
            wordDisplay.textContent = ''; 
        }
        
        const spellInterval = setInterval(() => {
            if (currentIndex < letters.length) {
                if (!wordDisplay.textContent.includes(letters.join(' '))) {
                    wordDisplay.textContent += letters[currentIndex] + ' ';
                }
                speakWord(letters[currentIndex]); 
                currentIndex++;
            } else {
                clearInterval(spellInterval);
                readingInput.focus();
            }
        }, 1000); 
    }

    function updateWord() {
        currentWord = getRandomWord();
        readingInput.value = '';
        rewardContainer.style.display = 'none';
        interactionItems.style.display = 'none';
        
        wordDisplay.textContent = 'Get ready...';
        setTimeout(() => {
            speakWord("Here's your word:");
            setTimeout(spellOutWord, 1000);
        }, 1000);
    }

    function checkWord() {
        if (readingInput.value.toLowerCase().trim() === currentWord.toLowerCase()) {
            wordDisplay.textContent = 'üåü Correct! üåü';
            rewardContainer.style.display = 'block';
            interactionItems.style.display = 'flex'; 
            speakWord("Great job! Choose your reward!");
            
            document.querySelectorAll('.interaction-item').forEach(item => {
                if (!item.hasEventListener) {
                    item.addEventListener('click', interactWithLeo);
                    item.hasEventListener = true;
                }
            });
            
            createParticles(
                puppy.getBoundingClientRect().left + puppy.getBoundingClientRect().width/2,
                puppy.getBoundingClientRect().top + puppy.getBoundingClientRect().height/2,
                'pet'
            );
            
        } else if (readingInput.value.length >= currentWord.length) {
            wordDisplay.textContent = '‚ùå Try again!';
            rewardContainer.style.display = 'none';
            interactionItems.style.display = 'none';
            speakWord("Try again!");
        }
    }

    readingInput.addEventListener('input', () => {
        checkWord();
    });

    nextWordBtn.addEventListener('click', updateWord);

    // Speech Recognition Setup
    const micButton = document.querySelector('.mic-button');
    const speechStatus = document.querySelector('.speech-status');
    const speakWordBtn = document.querySelector('.speak-word-btn');

    let recognition = null;
    if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        recognition.onstart = () => {
            micButton.classList.add('listening');
            speechStatus.textContent = 'Listening...';
        };

        recognition.onend = () => {
            micButton.classList.remove('listening');
            speechStatus.textContent = 'Listen to the spelling and guess the word';
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript.toLowerCase().trim();
            readingInput.value = transcript;
            if (transcript === currentWord.toLowerCase()) {
                checkWord();
            } else {
                wordDisplay.textContent = '‚ùå Try again!';
                rewardContainer.style.display = 'none';
                interactionItems.style.display = 'none';
                speakWord("Try again!");
            }
        };

        recognition.onerror = (event) => {
            console.error('Speech recognition error:', event.error);
            speechStatus.textContent = 'Error occurred. Please try again.';
            micButton.classList.remove('listening');
        };
    }

    // Text-to-Speech Setup
    const speechSynthesis = window.speechSynthesis;

    function speakWord(word) {
        if (speechSynthesis) {
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.rate = 0.8; 
            utterance.pitch = 1;
            speechSynthesis.speak(utterance);
        }
    }

    // Event Listeners for Speech Features
    micButton.addEventListener('click', () => {
        if (recognition) {
            recognition.start();
        } else {
            alert('Speech recognition is not supported in your browser.');
        }
    });

    speakWordBtn.addEventListener('click', () => {
        speechSynthesis.cancel();
        spellOutWord();
    });

    // Initialize first word with speech
    updateWord();
    </script>
</body>
</html>